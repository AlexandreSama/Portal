<!doctype html>
<html lang="en">

<head>
    <title>Accueil Minecraft</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700,800,900" rel="stylesheet">
    <link rel="stylesheet" href="../../components/assets/utilities/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.css">

    <script src="https://kit.fontawesome.com/e1f9f1b9af.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../../components/assets/css/minecraft/main.css">
    <style>
        #notification {
            position: fixed;
            bottom: 20px;
            left: 20px;
            width: 200px;
            padding: 20px;
            border-radius: 5px;
            background-color: white;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div class="wrapper d-flex align-items-stretch">
        <nav id="sidebar">
            <div class="custom-menu">
                <button type="button" id="sidebarCollapse" class="btn btn-primary">
                    <i class="fa fa-bars"></i>
                    <span class="sr-only">Toggle Menu</span>
                </button>
            </div>
            <h1><a href="#" class="logo">Portal</a></h1>
            <ul class="list-unstyled components mb-5">
                <li class="active">
                    <a href="#" id="Accueil"><span class="fas fa-home mr-3"></span> Accueil</a>
                </li>
                <li>
                    <a href="#" id="ModsList"><span class="fas fa-cubes mr-3"></span> Liste des mods</a>
                </li>
                <li>
                    <a href="#" id="BackToMain"><span class="fas fa-cubes mr-3"></span> Retour au menu des apps</a>
                </li>
                <li>
                    <a href="https://discord.gg/WUzUfay"><span class="fas fa-paper-plane mr-3"></span> Contact</a>
                </li>
            </ul>

        </nav>

        <!-- Page Content  -->
        <div id="content" class="p-4 p-md-5 pt-5"
            style="background-image: url(../../components/assets/images/minecraft/WallpaperBackgroundMain.jpg);">
            <h2 class="mb-4">Mod List</h2>
            <table id="ModTable" data-toggle="table" data-pagination="true" style="color: white; text-decoration: none;">
                <thead>
                    <tr>
                        <th data-checkbox="true"></th>
                        <th data-field="name">Nom du mods</th>
                    </tr>
                </thead>
            </table>

            <div id="notification" class="hidden">
                <p id="message"></p>
                <button id="close-button" onclick="closeNotification()" class="btn btn-danger">Fermer</button>
                <button id="restart-button" onclick="restartApp()" class="hidden btn-success"> Restart</button>
            </div>
        </div>

        <script>
            window.$ = window.jQuery = require('jquery');
        </script>
        <script src="../../components/assets/utilities/popper.js"></script>
        <script src="../../components/assets/utilities/bootstrap.min.js"></script>
        <script src="https://unpkg.com/bootstrap-table@1.19.1/dist/bootstrap-table.min.js"></script>
        <script src="../../components/assets/js/minecraft/main.js"></script>

        <script>
            const electron = require('electron')
            const ipc = electron.ipcRenderer
            const fs = require('fs')

            const notification = document.getElementById('notification')
            const message = document.getElementById('message')
            const restartButton = document.getElementById('restart-button')


            ipc.on('update_available', () => {
                ipc.removeAllListeners('update_available')
                message.innerText = 'Une mise a jour du launcher est disponible, je la télécharge pour vous...'
                notification.classList.remove('hidden')
            })

            ipc.on('update_downloaded', () => {
                ipc.removeAllListeners('update_downloaded')
                message.innerText =
                    'Mise a jour téléchargé avec succés, elle sera installé après un redémarrage. Redémarrer maintenant ?'
                restartButton.classList.remove('hidden')
                notification.classList.remove('hidden')
            })

            function closeNotification() {
                notification.classList.add('hidden')
            }

            function restartApp() {
                ipc.send('restart_app')
            }


            document.getElementById('Accueil').addEventListener('click', () => {
                ipc.send('GoToMain')
            })

            //   document.getElementById('BackToMain').addEventListener('click', () => {
            //       ipc.send('GoToMainApps')
            //   })

            ipc.on('ModList', (event, data) => {
                fs.readdir(data, 'utf8', (err, files) => {
                    files.forEach(element => {
                        $('#ModTable').bootstrapTable('insertRow', {
                            index: 1,
                            row: {
                                name: element
                            }
                        })
                    });
                })
            })
        </script>
</body>

</html>